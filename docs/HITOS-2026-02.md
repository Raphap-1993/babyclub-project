# Hitos 2026-02

Documento operativo para registrar cambios por hitos (scope, decision y evidencia).

## Hito 01 - UX Registro Base (2026-02-07)
Estado: Completado

Objetivo:
- Mejorar UX del registro sin romper contratos actuales.

Cambios aplicados:
- Barra de aforo con efecto visual tipo `btn-attention-red`.
- Campo `Apellidos` unificado en registro ticket y reserva.
- Reordenamiento de `Invitado por` inmediatamente despues de `Apellidos`.

Decision arquitectonica asociada:
- `docs/adr/2026-02-07-002-registro-apellidos-unificados.md`

Archivos tocados:
- `apps/landing/app/registro/page.tsx`
- `apps/landing/app/globals.css`
- `docs/adr/2026-02-07-002-registro-apellidos-unificados.md`

Validacion:
- `pnpm exec tsc --noEmit -p apps/landing/tsconfig.json`

## Hito 02 - Aislamiento Estricto por Evento (2026-02-07)
Estado: Completado

Objetivo:
- Evitar mezcla de datos entre eventos cuando hay mas de un evento activo en el mes.

Cambios aplicados:
- Eliminado fallback de `event_id` en reservas (ya no toma "primer evento activo").
- Resolucion de evento por consenso (`mesa`, `code`, `event_id` enviado) con validacion de conflicto.
- Nuevo filtro `event_id` en `GET /api/tables`.
- Landing ajustada para consultar mesas por `event_id` del codigo cuando existe.
- Compra ajustada para recargar mesas por evento seleccionado.

Decision arquitectonica asociada:
- `docs/adr/2026-02-07-003-event-scoping-strict.md`

Archivos tocados:
- `apps/landing/app/api/reservations/route.ts`
- `apps/landing/app/api/tables/route.ts`
- `apps/landing/app/registro/page.tsx`
- `apps/landing/app/compra/page.tsx`
- `apps/landing/app/api/reservations/route.test.ts`
- `apps/landing/app/api/tables/route.test.ts`
- `docs/adr/2026-02-07-003-event-scoping-strict.md`

Validacion:
- `pnpm test apps/landing/app/api/reservations/route.test.ts apps/landing/app/api/tables/route.test.ts`

## Hito 03 - Multi-Organizador Base (2026-02-07)
Estado: Completado

Objetivo:
- Preparar la plataforma para operar eventos de Baby y aliados en la misma instancia (sin subdominios).

Cambios aplicados:
- Nueva tabla `organizers`.
- Nuevas columnas `organizer_id` en `events`, `promoters` y `payments`.
- Backfill de datos existentes al organizador default (`babyclub`).
- Backoffice: creación/edición de eventos con selector de organizador.
- Backoffice: filtro de organizador en listado de eventos y tickets.

Decision arquitectonica asociada:
- `docs/adr/2026-02-07-004-multi-organizer-close-reports.md`

Archivos tocados:
- `supabase/migrations/2026-02-07-add-organizers-and-event-close.sql`
- `apps/backoffice/app/api/organizers/route.ts`
- `apps/backoffice/app/api/events/create/route.ts`
- `apps/backoffice/app/api/events/update/route.ts`
- `apps/backoffice/app/admin/events/components/EventForm.tsx`
- `apps/backoffice/app/admin/events/page.tsx`
- `apps/backoffice/app/admin/events/EventsClient.tsx`
- `apps/backoffice/app/admin/events/[id]/edit/page.tsx`
- `apps/backoffice/app/admin/tickets/page.tsx`
- `apps/backoffice/app/admin/tickets/TicketsClient.tsx`
- `apps/backoffice/app/api/admin/tickets/export/route.ts`

Validacion:
- `pnpm exec tsc --noEmit -p apps/backoffice/tsconfig.json`

## Hito 04 - Cierre Operativo de Evento (2026-02-07)
Estado: Completado

Objetivo:
- Cerrar eventos sin borrar histórico, desactivando códigos y dejando trazabilidad auditable.

Cambios aplicados:
- API admin `POST /api/events/close`.
- Al cerrar:
  - desactiva códigos activos del evento,
  - marca `events.is_active=false`,
  - registra `closed_at`, `closed_by`, `close_reason`,
  - escribe log en `process_logs`.
- Backoffice: botón `Cerrar evento` en acciones del módulo Eventos.

Decision arquitectonica asociada:
- `docs/adr/2026-02-07-004-multi-organizer-close-reports.md`

Archivos tocados:
- `apps/backoffice/app/api/events/close/route.ts`
- `apps/backoffice/app/admin/events/components/EventActions.tsx`
- `supabase/migrations/2026-02-07-add-organizers-and-event-close.sql`

Validacion:
- `pnpm exec tsc --noEmit -p apps/backoffice/tsconfig.json`

## Hito 05 - Motor Backend de Reportes/Export (2026-02-07)
Estado: Completado

Objetivo:
- Exponer reportes por organizador/evento/promotor desde backend con export CSV (sin lógica duplicada en frontend).

Cambios aplicados:
- API admin `GET /api/admin/reports/export` con filtros:
  - `report=promoter_performance|event_attendance|event_sales`
  - `organizer_id`, `event_id`, `promoter_id`, `from`, `to`
  - `format=json|csv`
- Nuevas pantallas operativas:
  - `admin/reportes/promotores`
  - `admin/reportes/mesas`
- Integración de export CSV autenticado desde UI.

Decision arquitectonica asociada:
- `docs/adr/2026-02-07-004-multi-organizer-close-reports.md`

Archivos tocados:
- `apps/backoffice/app/api/admin/reports/export/route.ts`
- `apps/backoffice/app/admin/reportes/components/ReportWorkspace.tsx`
- `apps/backoffice/app/admin/reportes/promotores/page.tsx`
- `apps/backoffice/app/admin/reportes/mesas/page.tsx`

Validacion:
- `pnpm exec tsc --noEmit -p apps/backoffice/tsconfig.json`

## Plantilla para siguientes hitos
- ID: Hito XX
- Fecha:
- Objetivo:
- Cambios aplicados:
- Decision/ADR:
- Archivos tocados:
- Validacion:
- Riesgos abiertos:
